% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/biovar_ported.R
\name{calculate_parameter_diagnostics}
\alias{calculate_parameter_diagnostics}
\title{Calculate and Merge Advanced MCMC Diagnostics}
\usage{
calculate_parameter_diagnostics(nonpermuted_fit, rhat_and_n_eff)
}
\arguments{
\item{nonpermuted_fit}{An array of MCMC simulations, the output of
\code{rstan::extract(..., permuted = FALSE)}. The dimension names should
be \code{iterations}, \code{chains}, and \code{parameters}.}

\item{rhat_and_n_eff}{A matrix containing the R-hat and n_eff values for
each parameter. This is typically the output of
\code{rstan::summary(...)$summary} subsetted to the \code{Rhat} and
\code{n_eff} columns. It must have rownames corresponding to parameter
names. It must have columns named \code{Rhat} and \code{n_eff}.}
}
\value{
A \code{data.table} with columns: \code{parameter}, \code{Rhat},
\code{n_eff}, \code{bulk_n_eff}, and \code{tail_n_eff}. \code{n_eff} is the
original mean effective sample sizes, while the bulk/tail
effective sample sizes are newly calculated.
}
\description{
This function calculates bulk and tail Effective Sample Sizes (ESS) from a
non-permuted MCMC simulations array (e.g., from \code{rstan::extract}) and
merges them with pre-calculated R-hat and mean ESS values (e.g., from
\code{rstan::summary}).

The function is written to be robust, performing several critical checks:
\enumerate{
 \item Validates input types (array, matrix).
 \item Ensures column names (\code{Rhat}, \code{n_eff}) exist in
       \code{rhat_and_n_eff}.
 \item Ensures parameter names match exactly between both inputs.
 \item Ensures parameter order matches exactly between both inputs.
}
}
\details{
This function is written for a *specific* set of Bayesian models, namely
the NTT (or NNN, NTN, or NNT) and NTTDFGAM biological variation models.

It relies on the \code{rstan} package for \code{ess_bulk()} and
\code{ess_tail()}.

This function is not intended to be used by end-users. It is intended to be
used as a helper function for the package developer, in her biological
variation application.
}
\examples{
\dontrun{
# This example requires a 'stanfit' object 'my_stan_fit' and the
# 'rstan', 'posterior', and 'data.table' packages.

# 1. Load required libraries
library(biovar)

# 2. Extract non-permuted draws
np_fit <- rstan::extract(object = my_stan_fit, permuted = FALSE)

# 3. Get Rhat and n_eff summary
fit_summary <- rstan::summary(my_stan_fit)$summary
rhat_n_eff_matrix <- fit_summary[, c("Rhat", "n_eff"), drop = FALSE]

# 4. Calculate all diagnostics
all_diags <- calculate_parameter_diagnostics(
  nonpermuted_fit = np_fit,
  rhat_and_n_eff = rhat_n_eff_matrix
)

print(all_diags)
}

}
